<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>Main</title>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Stoke">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Ubuntu">
    <link rel="stylesheet" href="style/bingo.css">
    <link rel="stylesheet" href="style/bingo-desktop.css">
    <link rel="stylesheet" href="style/bingo-dark.css">
    <script src="main.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164555323-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-164555323-1');
    </script>

</head>
<body>
<div id="elm-root"></div>
<script type="application/javascript">
    function IEdetection() {
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf('MSIE ');
        if (msie > 0) {
            // IE 10 or older, return version number
            return ('IE ' + parseInt(ua.substring(
                msie + 5, ua.indexOf('.', msie)), 10));
        }
        var trident = ua.indexOf('Trident/');
        if (trident > 0) {
            // IE 11, return version number
            var rv = ua.indexOf('rv:');
            return ('IE ' + parseInt(ua.substring(
                rv + 3, ua.indexOf('.', rv)), 10));
        }
        var edge = ua.indexOf('Edge/');
        if (edge > 0) {
            //Edge (IE 12+), return version number
            return ('IE ' + parseInt(ua.substring(
                edge + 5, ua.indexOf('.', edge)), 10));
        }
        // User uses other browser
        return ('Not IE');
    }

    if (IEdetection() === 'Not IE') {

        const storedUserSettings = localStorage.getItem('user-settings-app-save');
        const userSettings = storedUserSettings ? JSON.parse(storedUserSettings) : {};
        const dark = window.matchMedia && window.matchMedia("(prefers-color-scheme:dark)").matches

        const flags = {
            dark,
            userSettings
        };

        const app = Elm.Main.init({
            flags: flags,
            node: document.getElementById("elm-root")
        });
        app.ports.storeUserSettings.subscribe(function(userSettings) {
            if (userSettings) {
                localStorage.setItem('user-settings-app-save', userSettings);
            }
        });
        app.ports.publishGaEvent.subscribe(function(params){
            let event = JSON.parse(params);
            console.log('Sent Event:', params);
            console.log('Sent Event:', event.eventType, event.eventCategory);
            // gtag('event', 'dauber-color', {'event_category': 'goofy-green'});
            gtag('event', event.eventType, {'event_category': event.eventCategory});
        })


    } else {
        document.body.innerHTML = "" +
            "<div style='text-align: center;'>" +
            "   <h1>For the best experience please open using Chrome, Firefox, Safari or any modern browser really.</h1>\n" +
            "   <h2>üôè Please stop using IE üôè</h2>" +
            "</div>";
    }

</script>
</body>
</html>
